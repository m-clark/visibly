# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r


# Header
language: r
sudo: false
dist: trusty
cache: packages
latex: false

warnings_are_errors: false

matrix:
  include:
  - r: 3.4.0
  - r: release

  allow_failures:
  #- r: 3.4.0

  r_binary_packages:
    - devtools
    - rstan
    - rstanarm
    - RCurl
    - dplyr
    - glue
    - magrittr
    - stringi
    - stringr
    - munsell
    - rlang
    - reshape2
    - scales
    - tibble
    - ggplot2
    - StanHeaders
    - Rcpp
    - RcppEigen
    - BH

  # for rstan
   - os: linux
     dist: trusty
     r: release
     r_binary_packages:
       - devtools
     addons:
       apt:
         sources:
           - ubuntu-toolchain-r-test
         packages:
           - g++-7
     env:
       - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"

repos:
  CRAN: https://cloud.r-project.org
  ropensci: http://packages.ropensci.org


before_install:
  - mkdir -p ~/.R && echo "CXX14=g++-7" > ~/.R/Makevars
  - echo "CXX14FLAGS += -g -O2 -pedantic -g0 -fPIC" >> ~/.R/Makevars
  - cat ~/.R/Makevars
  - sudo apt-get -y install libnlopt-dev
  - sudo apt-get update

r_packages:
  - covr

after_success:
  - Rscript -e "library(covr); codecov(line_exclusions = list('R/colorgorical.R'=135:163,
                                                              'R/corr_heat.R'=90:107,
                                                              'R/create_palette.R'=35:39,
                                                              'R/plot_coefs.R'=18:20,
                                                              'R/plot_gam_check.R'=c(103:110, 119:120, 167:169),
                                                              'R/plot_gam_2d.R'=c(154:156),
                                                              'R/color_contrast_checker.R'=65:70
                                                              ))"
